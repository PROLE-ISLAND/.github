# =====================================================
# Reusable Stale Issues/PRs
# æ”¾ç½®ã•ã‚ŒãŸIssue/PRã®è‡ªå‹•è­¦å‘Šãƒ»ã‚¯ãƒ­ãƒ¼ã‚º
# =====================================================

name: Reusable Stale

on:
  workflow_call:
    inputs:
      language:
        description: 'Primary language for messages (ja/en)'
        required: false
        default: 'ja'
        type: string
      days_before_issue_stale:
        description: 'Days before marking issues as stale'
        required: false
        default: 30
        type: number
      days_before_issue_close:
        description: 'Days after stale before closing issues'
        required: false
        default: 7
        type: number
      days_before_pr_stale:
        description: 'Days before marking PRs as stale'
        required: false
        default: 14
        type: number
      days_before_pr_close:
        description: 'Days after stale before closing PRs'
        required: false
        default: 7
        type: number
      exempt_issue_labels:
        description: 'Labels that prevent issues from going stale (comma-separated)'
        required: false
        default: 'P0,P1,blocked,in-progress,decision'
        type: string
      exempt_pr_labels:
        description: 'Labels that prevent PRs from going stale (comma-separated)'
        required: false
        default: 'blocked,in-progress'
        type: string
      operations_per_run:
        description: 'Maximum operations per run'
        required: false
        default: 100
        type: number

jobs:
  stale:
    name: Mark Stale
    runs-on: ubuntu-latest

    steps:
      - name: Stale Action
        uses: actions/stale@v9
        with:
          # === Issue Settings ===
          stale-issue-message: |
            ${{ inputs.language == 'ja' && format('âš ï¸ **ã“ã®Issueã¯{0}æ—¥é–“æ›´æ–°ãŒã‚ã‚Šã¾ã›ã‚“**

            - å¼•ãç¶šãå¯¾å¿œãŒå¿…è¦ãªå ´åˆã¯ã‚³ãƒ¡ãƒ³ãƒˆã‚’è¿½åŠ ã—ã¦ãã ã•ã„
            - {1}æ—¥ä»¥å†…ã«ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ãŒãªã„å ´åˆã€è‡ªå‹•çš„ã«ã‚¯ãƒ­ãƒ¼ã‚ºã•ã‚Œã¾ã™

            > ä½œæ¥­ã‚’å†é–‹ã™ã‚‹å ´åˆã¯ `ready-to-develop` ãƒ©ãƒ™ãƒ«ã‚’è¿½åŠ ã—ã¦ãã ã•ã„', inputs.days_before_issue_stale, inputs.days_before_issue_close) || format('âš ï¸ **This issue has had no activity for {0} days**

            - Please add a comment if this is still needed
            - It will be automatically closed after {1} more days of inactivity

            > Add `ready-to-develop` label to resume work', inputs.days_before_issue_stale, inputs.days_before_issue_close) }}
          stale-issue-label: 'stale'
          days-before-issue-stale: ${{ inputs.days_before_issue_stale }}
          days-before-issue-close: ${{ inputs.days_before_issue_close }}
          close-issue-message: |
            ${{ inputs.language == 'ja' && 'ğŸ”’ **ã“ã®Issueã¯è‡ªå‹•ã‚¯ãƒ­ãƒ¼ã‚ºã•ã‚Œã¾ã—ãŸ**

            é•·æœŸé–“æ›´æ–°ãŒãªã‹ã£ãŸãŸã‚ã€è‡ªå‹•çš„ã«ã‚¯ãƒ­ãƒ¼ã‚ºã—ã¾ã—ãŸã€‚
            å¼•ãç¶šãå¯¾å¿œãŒå¿…è¦ãªå ´åˆã¯ã€å†åº¦Issueã‚’ã‚ªãƒ¼ãƒ—ãƒ³ã—ã¦ãã ã•ã„ã€‚' || 'ğŸ”’ **This issue has been automatically closed**

            Due to inactivity, this issue has been automatically closed.
            Please reopen if this is still needed.' }}

          # === PR Settings ===
          stale-pr-message: |
            ${{ inputs.language == 'ja' && format('âš ï¸ **ã“ã®PRã¯{0}æ—¥é–“æ›´æ–°ãŒã‚ã‚Šã¾ã›ã‚“**

            - ãƒ¬ãƒ“ãƒ¥ãƒ¼å¾…ã¡ã®å ´åˆã¯ãƒ¬ãƒ“ãƒ¥ã‚¢ãƒ¼ã‚’ãƒ¡ãƒ³ã‚·ãƒ§ãƒ³ã—ã¦ãã ã•ã„
            - ä½œæ¥­ä¸­ã®å ´åˆã¯ã‚³ãƒ¡ãƒ³ãƒˆã‚’è¿½åŠ ã—ã¦ãã ã•ã„
            - {1}æ—¥ä»¥å†…ã«ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ãŒãªã„å ´åˆã€è‡ªå‹•çš„ã«ã‚¯ãƒ­ãƒ¼ã‚ºã•ã‚Œã¾ã™', inputs.days_before_pr_stale, inputs.days_before_pr_close) || format('âš ï¸ **This PR has had no activity for {0} days**

            - If waiting for review, please mention reviewers
            - If work in progress, please add a comment
            - It will be automatically closed after {1} more days of inactivity', inputs.days_before_pr_stale, inputs.days_before_pr_close) }}
          stale-pr-label: 'stale'
          days-before-pr-stale: ${{ inputs.days_before_pr_stale }}
          days-before-pr-close: ${{ inputs.days_before_pr_close }}
          close-pr-message: |
            ${{ inputs.language == 'ja' && 'ğŸ”’ **ã“ã®PRã¯è‡ªå‹•ã‚¯ãƒ­ãƒ¼ã‚ºã•ã‚Œã¾ã—ãŸ**

            é•·æœŸé–“æ›´æ–°ãŒãªã‹ã£ãŸãŸã‚ã€è‡ªå‹•çš„ã«ã‚¯ãƒ­ãƒ¼ã‚ºã—ã¾ã—ãŸã€‚
            å¼•ãç¶šãä½œæ¥­ã‚’è¡Œã†å ´åˆã¯ã€å†åº¦PRã‚’ã‚ªãƒ¼ãƒ—ãƒ³ã—ã¦ãã ã•ã„ã€‚' || 'ğŸ”’ **This PR has been automatically closed**

            Due to inactivity, this PR has been automatically closed.
            Please reopen if work needs to continue.' }}

          # === Exemptions ===
          exempt-issue-labels: ${{ inputs.exempt_issue_labels }}
          exempt-pr-labels: ${{ inputs.exempt_pr_labels }}
          labels-to-remove-when-unstale: 'stale'
          exempt-draft-pr: true

          # === Limits ===
          operations-per-run: ${{ inputs.operations_per_run }}
