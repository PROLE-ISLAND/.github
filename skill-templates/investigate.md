# /investigate - 既存システム調査スキル

## 概要

既存システムの実装を調査し、標準化された調査レポートを出力するスキル。
Issue作成前または要件定義前に使用し、既存実装の理解なしに開発を始めることを防ぐ。

---

## 使用タイミング

### パターン1: 調査 → Issue（推奨）

```
/investigate → 調査レポート作成 → Issue作成（レポートをリンク）
```

既存システムを理解してからIssueを起票する。**原則としてこのパターンを推奨**。

### パターン2: Issue → 調査（救済）

```
Issue作成 → /investigate → 調査レポートをIssueコメントに投稿
```

Issueが先に作成された場合の後追い調査。

---

## 起動方法

```bash
/investigate {調査対象}
```

**例**:
```bash
/investigate 性格検査の評価ロジック
/investigate 候補者登録API
/investigate レポート生成機能
```

---

## 出力フォーマット（Investigation Report v1）

**必須**: 以下のフォーマットで調査レポートを出力すること。

````markdown
# Investigation Report v1

**調査日**: YYYY-MM-DD
**調査者**: @username
**調査対象**: {調査対象の説明}

---

## 1. 既存システム名

**名前**: {システム名とバージョン}

例: `GFD-Gate v1`, `Assessment Engine v2.1`, `Report Generator`

---

## 2. 入口（エントリーポイント）

| 種別 | パス/エンドポイント | 説明 |
|------|-------------------|------|
| UI | /xxx | |
| API | POST /api/xxx | |
| CLI | npm run xxx | |

---

## 3. 主要データモデル

### テーブル/コレクション

| テーブル | 説明 | 主要カラム |
|---------|------|-----------|
| | | |

### 主要な型定義

```typescript
// 型定義をここに記載
interface XxxModel {
  id: string;
  // ...
}
```

---

## 4. 主要ファイル（3〜10個）

| ファイル | 役割 | 重要度 |
|---------|------|--------|
| src/xxx/index.ts | エントリーポイント | High |
| src/xxx/service.ts | ビジネスロジック | High |
| src/xxx/types.ts | 型定義 | Medium |

---

## 5. 拡張ポイント

**どこに機能を追加すればよいか**

| ポイント | ファイル | 説明 |
|---------|---------|------|
| 新規評価軸追加 | src/xxx/evaluators/ | 新規ファイル追加 |
| API拡張 | src/app/api/xxx/ | 既存ファイル修正 |

---

## 6. 破壊ポイント

**変更時に壊れる可能性がある箇所**

| ポイント | ファイル | リスク | 対策 |
|---------|---------|--------|------|
| | | High/Med/Low | |

---

## 7. 今回やりたいこと（1行）

**差分**: {既存システムからの差分を1行で}

例: `既存6軸評価にBig5性格検査の5軸を追加する`

---

## 8. 次のステップ

- [ ] Issue作成（このレポートをリンク）
- [ ] ラフ要件定義作成
- [ ] デザインモック作成（UI変更がある場合）
````

---

## 調査プロセス

### Step 1: コードベース探索

```bash
# 関連ファイルを検索
grep -r "キーワード" src/
find . -name "*.ts" | xargs grep "関連する関数名"
```

### Step 2: データモデル特定

- DB スキーマファイル（`supabase/migrations/`）を確認
- 型定義ファイル（`src/types/`）を確認

### Step 3: フロー追跡

- UI → API → Service → DB の流れを追跡
- 主要な関数呼び出しチェーンを特定

### Step 4: 拡張ポイント特定

- 既存コードの構造を分析
- 新機能を追加する最適な場所を特定

### Step 5: 破壊ポイント特定

- 変更が影響する箇所を洗い出し
- テストカバレッジを確認

---

## 完了条件

調査完了の条件:

- [ ] Investigation Report v1 フォーマットで出力した
- [ ] 既存システム名が特定されている
- [ ] 主要ファイル（3〜10個）がリストアップされている
- [ ] 拡張ポイントが特定されている
- [ ] 破壊ポイントが特定されている
- [ ] 「今回やりたいこと」が1行で記載されている

---

## ラベル管理

| タイミング | ラベル操作 |
|-----------|-----------|
| Issue作成時（未調査） | `needs-investigation` 付与 |
| 調査レポート投稿後 | `needs-investigation` → `investigation-complete` |
| 要件定義開始可能 | `investigation-complete` + `needs-requirements` |

---

## 関連ドキュメント

- [[調査スキル活用ガイド]] - 詳細なガイドライン
- [[システム仕様書ガイド]] - 仕様書作成方法
- [[要件定義テンプレート]] - 調査後の要件定義

---

## 更新履歴

| 日付 | 内容 |
|-----|------|
| 2025-12-30 | 初版作成 |
